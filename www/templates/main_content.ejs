<div class="main-content">
  <div class="main-content-files-and-buttons">

  <div id="fileDropArea" class="file-drop-area">
    <label for="fileSelectorInput">
      <div class="file-drop-icon">üìÅ</div>
      <h3>Drop CSV Files Here</h3>
      <p>or click to browse files</p>
    </label>
    <input type="file" multiple style="display:none" id="fileSelectorInput">
  </div>

  <div class="file-list">
    <!-- eg.
     <div class="file-item">
      <span class="file-item-name">sample_data.csv</span>
      <button class="file-remove-btn">&times;</button>
    </div>
    -->
  </div>

  <div class="form-group">
    <label for="acbFeatureModeSelect">Mode:</label>
    <select id="acbFeatureModeSelect" style="width: fit-content;">
      <option value="calculate" selected>Calculate Gains</option>
      <!-- Both of these will show the date selector when active. -->
      <!-- This essentially runs the equivalent of
           `acb --summarize-annual-gains --summarize-before DATE`  -->
      <option value="tx_summary" >Summarize Transactions</option>
       <!-- This essentially runs the equivalent of what
            `acb --summarize-before DATE` , and then just extracts the share numbers
            and displays them. -->
      <option value="tally_shares">Tally Share Balances</option>
    </select>

    <!-- The date portion should default to Dec 31, and the year should
         be the previous year. -->
    <label for="acbSummaryDatePicker" style="margin-left: 10px; display: none;">Latest Date:</label>
    <input type="date" id="acbSummaryDatePicker"
           style="width: fit-content; margin-left: 10px; display: none;">
  </div>

  <div class="action-buttons">
    <button id="runButton" class="btn btn-primary" disabled="true">Run</button>
    <button id="clearFilesButton" class="btn btn-secondary" disabled="true">Clear Files</button>
  </div>

  </div> <!-- class="main-content-files-and-buttons" -->

  <div class="separator"></div>

  <%- include('error_box', {containerId: "mainErrorContainer"}) %>

  <div class="output-area">
    <div class="output-header">
      <h2 class="output-title">Results</h2>
      <div class="export-options">
        <button id="exportButton" class="btn btn-secondary">Export</button>
      </div>
    </div>

    <div class="collapsible-wrapper">
      <button class="collapsible-content-btn">
        <img class="toggle-icon" src="/images/chevron-right.svg"/>
        <img src="/images/eye.svg" style="height: 24px; filter: invert(0.5)">
        View Settings
      </button>
      <div class="collapsible-content collapsed">
        <div class="collapsible-content-inner">
          <div class="collapsible-content-padded-inner">
            <h3>Output View Settings</h3>

            <div class="form-group">
              <label for="yearHighlightSelect">Highlight Year:</label>
              <select id="yearHighlightSelect">
                <option value="" selected>None</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
                <option value="2019">2019</option>
                <option value="2018">2018</option>
                <option value="2017">2017</option>
                <!-- The years here don't really matter, since they'll be
                      set according to the output -->
              </select>
            </div>

            <div class="form-group" style="display: inline-flex;">
              <input type="checkbox" id="hideNoActivityCheckbox" style="margin-right: 8px; width: fit-content;" />
              <label for="hideNoActivityCheckbox">Hide securities with no activity in selected year</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="view-mode-toggle">
      <button class="view-mode-btn active" data-view-mode="security_tables">Securities</button>
      <button class="view-mode-btn" data-view-mode="summary">Summary</button>
      <button class="view-mode-btn" data-view-mode="aggregate">Aggregate</button>
      <button class="view-mode-btn" data-view-mode="text">Raw Text</button>
    </div>

    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Processing files...</p>
    </div>

    <div class="acb-output-container">
      <div id="acbSecurityTablesOutput" class="acb-output"></div>
      <div id="acbSummaryOutput" class="acb-output"></div>
      <div id="acbAggregateOutput" class="acb-output"></div>
      <pre id="acbTextOutput" class="acb-output"></pre>
    </div>

  </div>
</div>